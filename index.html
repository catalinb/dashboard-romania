<!doctype html>

<style>
    .axis path {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .axis text {
        font-size: 12px;
    }

    .series {
        fill: none;
        stroke-width: 2px;
        stroke: #aaa;
    }

    .series-eu_avg {
        stroke-width: 1px;
    }

    .series-ro {
        stroke: steelblue;
    }

    .envelope {
        fill: #aaa;
        opacity: .2;
    }
</style>

<body>

<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js"></script>
<script src="coffee-script.js"></script>
<script type="text/coffeescript">
'use strict'

d3.csv('gdp.csv').get (err, rows) ->
    x = d3.scale.linear()
      .domain(d3.extent(rows, (r) -> +r.year))
      .range([0, 700])

    y = d3.scale.linear()
      .domain([0, d3.max(rows, (r) -> +r.eu_max)])
      .range([300, 0])

    pluck = (rows, n) ->
        rv = []
        for r in rows
            if r[n]?
                rv.push([x(r.year), y(r[n])])
        return rv

    xAxis = d3.svg.axis()
        .scale(x)
        .tickFormat((d) -> +d)

    yAxis = d3.svg.axis()
        .scale(y)
        .orient('left')

    svg = d3.select('body').append('svg')
        .attr('width', 800)
        .attr('height', 400)
      .append('g')
        .attr('transform', 'translate(75, 50)')

    svg.append('g')
        .attr('class', 'axis axis-x')
        .attr('transform', 'translate(0, 300)')
        .call(xAxis)

    svg.append('g')
        .attr('class', 'axis axis-y')
        .call(yAxis)

    svg.selectAll('.series')
        .data(['eu_min', 'eu_max', 'eu_avg', 'ro'])
      .enter().append('path')
        .attr('class', (n) -> "series series-#{n}")
        .attr('d', (n) -> d3.svg.line()(pluck(rows, n)))

    svg.append('path')
        .attr('class', 'envelope')
        .datum([].concat(
            pluck(rows, 'eu_min')
            pluck(rows, 'eu_max').reverse()
        ))
        .attr('d', (d) -> d3.svg.line()(d))


</script>
